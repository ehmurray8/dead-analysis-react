{"version":3,"sources":["../server.js"],"names":["app","pool","DbConfig","use","express","json","credentials","origin","post","req","res","artistId","params","status","send","get","allSongs","allOriginals","allCovers","promises","catch","error","console","log","then","songs","push","originals","covers","Promise","all","artistName","artists","sortArtists","firstArtist","secondArtist","first","name","second","hasData","localeCompare","sort","query","queryResponse","rows","songId","setlists","setlistId","setlist","venues","venueInfo","stateInfo","usStates","forEach","x","features","filter","country_code","venue","state","type","geometry","coordinates","longitude","latitude","properties","title","times_played","stateNumShows","Object","keys","map","key","exitHandler","end","listen"],"mappings":"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","sourcesContent":["import express from 'express';\nimport loadSetlists from \"./src/load_setlists\";\nimport {DbConfig} from \"./src/keys\";\nimport {Pool} from 'pg';\nimport searchArtist from \"./src/search_artist\";\nimport {\n    getAllCovers,\n    getAllOriginals,\n    getAllSetlistsBySong,\n    getAllSongs, getAllVenuesByArtist,\n    getSetlistInfo\n} from './src/database_queries';\nimport \"@babel/polyfill\";\nimport cors from 'cors';\nimport {usStates} from \"./src/constants\";\n\n\nconst app = express();\n\nconst pool = Pool(DbConfig); app.use(express.json());\n\napp.use(cors({\n    credentials: true,\n    origin: true,\n}));\n\n// Download data\napp.post('/artist/:artistId', (req, res) => {\n    const artistId = req.params.artistId;\n    loadSetlists(artistId, pool);\n    return res.status(200).send(\"Downloading \" + artistId + \" data...\");\n});\n\n// Get song data\napp.get('/artist/:artistId/', async (req, res) => {\n    const artistId = req.params.artistId;\n    let allSongs = [];\n    let allOriginals = [];\n    let allCovers = [];\n    const promises = [\n        getAllSongs(pool, artistId)\n            .catch((error) => console.log(error))\n            .then((songs) => {\n                allSongs.push(...songs);\n            }),\n        getAllOriginals(pool, artistId)\n            .catch((error) => console.log(error))\n            .then((originals) => {\n                allOriginals.push(...originals);\n            }),\n        getAllCovers(pool, artistId)\n            .catch((error) => console.log(error))\n            .then((covers) => {\n                allCovers.push(...covers);\n            })\n    ];\n    await Promise.all(promises);\n    return res.status(200).send({\n        songs: allSongs,\n        covers: allCovers,\n        originals: allOriginals,\n    });\n});\n\n// Search for an artist\napp.get('/search/artists/:artistName', async (req, res) => {\n    const artistName = req.params.artistName;\n    const artists = await searchArtist(artistName, pool).catch((error) => console.log(error));\n    console.log(artists);\n    const sortArtists = (firstArtist, secondArtist) => {\n        const first = firstArtist.name;\n        const second = secondArtist.name;\n        if (first === artistName) {\n            return -1;\n        } else if (second === artistName) {\n            return 1;\n        } else if (first.hasData && second.hasData) {\n            return first.localeCompare(second);\n        } else if (first.hasData) {\n            return -1;\n        } else if (second.hasData) {\n            return 1;\n        } else {\n            return first.localeCompare(first);\n        }\n    };\n    if (artists) {\n        artists.sort(sortArtists);\n    }\n    return res.status(200).send(artists);\n});\n\n// Get an artist's name from their id\napp.get('/artist/:artistId/name', async (req, res) => {\n    const artistId = req.params.artistId;\n    const queryResponse = await pool.query(`SELECT \"Artist\".name FROM \"Artist\" WHERE \"Artist\".mbid = '${artistId}'`);\n    const artistName = (queryResponse.rows && queryResponse.rows[0] && queryResponse.rows[0].name) || \"\";\n    return res.status(200).send(artistName);\n});\n\n// Get setlist info for a given song played by an artist\napp.get('/artist/:artistId/song/:songId', async (req, res) => {\n    const artistId = req.params.artistId;\n    const songId = req.params.songId;\n    const setlists = await getAllSetlistsBySong(pool, songId, artistId);\n    return res.status(200).send(setlists);\n});\n\n// Get information about a setlist\napp.get('/setlist/:setlistId', async (req, res) => {\n    const setlistId = req.params.setlistId;\n    const setlist = await getSetlistInfo(pool, setlistId);\n    return res.status(200).send(setlist);\n});\n\napp.get('/artist/:artistId/locations', async (req, res) => {\n    const artistId = req.params.artistId;\n    const venues = await getAllVenuesByArtist(pool, artistId);\n    const venueInfo = {\n        \"type\": \"geojson\",\n        \"data\": {\n            \"type\": \"FeatureCollection\",\n        }\n    };\n    const stateInfo = {};\n    usStates.forEach(x => stateInfo[x] = 0);\n    const features = [];\n    venues.filter(x => x.country_code = \"US\").forEach(venue => {\n        if (venue.state === \"Washington, D.C.\") {\n            venue.state = \"District of Columbia\";\n        }\n        stateInfo[venue.state] += 1;\n        features.push({\n            type: \"Feature\",\n            geometry: {\n                type: \"Point\",\n                coordinates: [venue.longitude, venue.latitude],\n            },\n            properties: {\n                title: venue.name + \" - \" + venue.times_played + \" shows\",\n                'marker-symbol': \"monument\",\n            },\n        });\n    });\n    venueInfo.features = features;\n    const stateNumShows = Object.keys(stateInfo).map(key => stateInfo[key]);\n    return res.status(200).send([venueInfo, stateNumShows]);\n});\n\napp.get('/artist/:artistId/typical-concert', (req, res) => {\n    const artistId = req.params.artistId;\n    return res.status(200).send(\"Ok\");\n});\n\napp.get('/artist/:artistId/covers', (req, res) => {\n    const artistId = req.params.artistId;\n    return res.status(200).send(\"Ok\");\n});\n\napp.get('/artist/:artistId/tours', (req, res) => {\n    const artistId = req.params.artistId;\n    return res.status(200).send(\"Ok\");\n});\n\napp.get('/artist/:artistId/venues', (req, res) => {\n    const artistId = req.params.artistId;\n    return res.status(200).send(\"Ok\");\n});\n\napp.get('/artist/:artistId/songs_by', (req, res) => {\n    const artistId = req.params.artistId;\n    return res.status(200).send(\"Ok\");\n});\n\nconst exitHandler = () => {\n    pool.end();\n    console.log(\"Exiting\")\n};\n\n// process.on('exit', exitHandler);\n// process.on('SIGINT', exitHandler);\n// process.on('SIGUSR1', exitHandler);\n// process.on('SIGUSR2', exitHandler);\n// process.on('uncaughtException', exitHandler);\n\napp.listen(3001);\nconsole.log('app running on port.', 3001);\n"],"file":"server.js"}